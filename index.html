<!DOCTYPE html>
<html>
  <head>
    <title>Mobile Barcode & QR Scanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.slim.min.js"></script>

<!-- Popper JS -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  </head>
  <body>
    <h1>Mobile Barcode & QR Scanner</h1>
    <video id="preview" style="width: 100%; height: auto;"></video>
    <div id="result"></div>
    <button class="btn btn-warning" id="scanButton">Scan</button>
    <script>
      var scanner = null;

      // Create a new instance of the Quagga barcode scanner
      function createScanner() {
        Quagga.init({
          inputStream: {
            name: "Live",
            type: "LiveStream",
            constraints: {
              width: { min: 640 },
              height: { min: 480 },
              facingMode: "environment",
              aspectRatio: { min: 1, max: 2 }
            }
          },
          decoder: {
            readers: ["code_128_reader", "ean_reader", "ean_8_reader", "code_39_reader", "code_39_vin_reader", "codabar_reader", "upc_reader", "upc_e_reader", "i2of5_reader"]
          }
        }, function (err) {
          if (err) {
            console.log(err);
            return;
          }
          Quagga.start();
        });
      }

      // Stop the Quagga barcode scanner
      function stopScanner() {
        if (scanner) {
          Quagga.stop();
          scanner = null;
        }
      }

      // Create a new instance of the ZXing QR code scanner
      function createQRScanner() {
        var codeReader = new ZXing.BrowserQRCodeReader();
        codeReader.decodeOnceFromVideoDevice(undefined, 'preview').then(function (result) {
          document.getElementById("result").innerHTML = result.text;
          navigator.vibrate(200);
          setTimeout(createQRScanner, 1000);
        }).catch(function (err) {
          console.log(err);
          setTimeout(createQRScanner, 1000);
        });
      }

      // Start scanning when the "Scan" button is clicked
      var scanButton = document.getElementById("scanButton");
      scanButton.addEventListener("click", function (event) {
        if (scanner) {
          stopScanner();
          createQRScanner();
          scanButton.innerText = "Scan Barcode";
        } else {
          createScanner();
          scanButton.innerText = "Scan QR Code";
        }
        event.preventDefault();
      });

      // When a barcode is detected, display the result
      Quagga.onDetected(function (result) {
        document.getElementById("result").innerHTML = result.codeResult.code;
        navigator.vibrate(200);
        setTimeout(stopScanner, 1000);
      });

      // Start with the QR code scanner
      createQRScanner();
    </script>
  </body>
</html>